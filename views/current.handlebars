{{> navbar user}}

<div class="container-fluid">
    <div id="ml" style="color: rgb(18, 2, 119);">
        <h2>Hello {{user.firstname}} </h2>
    </div>
    <div class="row mt-5">
        <div class="col-md-4 col-lg-4 col-sm-8">

            <div id="activities" class="activity">
                <legend class="display-5" style="color: rgb(80, 28, 122);font-weight:bold">Fun things to do <i class="far fa-smile-beam"></i></legend>
                {{#each activities}}

                <div class="activities-card mt-3">

                    <h4 style="color: rgb(55, 2, 77);font-size:large">{{name}}</h4>
                    {{description}}

                    <div>
                        <h5 style="font-weight: bold;">Location:</h5>
                        <p>{{street}}, {{state}}, {{city}}, {{zip}}</p>
                    </div>

                    by {{'User.firstname'}}, Contact: {{'User.phone'}}
                    @ {{createdAt}}
                </div>
                {{/each}}

            </div>

        </div>
        <div class="col-md-8">
            <div id="map">

            </div>
        </div>
    </div>


</div>


<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDq70sJV45glTCIzAG9zL_ookT7DaKmP8&callback=initMap"></script>
<script>

    let geoAPIKey = "93d3ded8310f4bcd0816861f0428d0f8";
    // Initialize and add the map
     function initMap() {
        var center = {lat: 41.8781, lng: -87.6298};
        $.ajax({
            url: "http://localhost:8080/api/activities",
            method: "GET"
        }).then(function (activityresponse) {
            console.log(activityresponse);
            const locations = [];
            activityresponse.forEach(activity => {
                const activityArray = [];
                const activityName = `${activity.name}<br>`;
                const activityAddy = `${activity.address}, ${activity.city}, ${activity.state}, ${activity.zip}`;
                const totalAct = activityName + activityAddy;
                activityArray.push(totalAct);
                activityArray.push(activity.lat);
                activityArray.push(activity.lon);
                locations.push(activityArray)
            })
           
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 9,
                center: center
            });
            var infowindow = new google.maps.InfoWindow({});
            var marker, count;
            for (count = 0; count < locations.length; count++) {
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(locations[count][1], locations[count][2]),
                    map: map,
                    title: locations[count][0]
                });
                google.maps.event.addListener(marker, 'click', (function (marker, count) {
                    return function () {
                        infowindow.setContent(locations[count][0]);
                        infowindow.open(map, marker);
                    }
                })(marker, count));
            }
        })
    };

</script>